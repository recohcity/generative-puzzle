# 旋转配置

> 修订日期：2025-01-24 (v1.3.36)

本文档详细说明拼图块旋转系统的配置参数，包括旋转步长、旋转范围、旋转音效、双指旋转等核心配置。

---

## 1. 基础旋转配置

### rotationStep
- **作用**：每次旋转的角度增量
- **取值范围**：15（度，常量）
- **默认值**：15度
- **影响点**：旋转操作精度、吸附判定、用户体验
- **配置/代码位置**：`utils/puzzle/ScatterPuzzle.ts`、`contexts/GameContext.tsx`

### rotationDirection
- **作用**：旋转方向配置
- **取值范围**：'clockwise'（顺时针）| 'counterclockwise'（逆时针）| 'both'（双向）
- **默认值**：'both'（支持双向旋转）
- **影响点**：旋转操作的灵活性
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`（旋转逻辑）

### rotationMode
- **作用**：旋转模式配置
- **模式类型**：
  - 'discrete'：离散旋转（按步长）
  - 'continuous'：连续旋转（自由角度）
  - 'snap'：吸附旋转（自动对齐）
- **默认值**：'discrete'
- **影响点**：旋转操作的精确度和用户体验
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`

---

## 2. 初始旋转配置

### initialRotationRange
- **作用**：拼图块散开时的初始角度范围
- **取值范围**：0~345（度，随设备/难度动态调整）
- **设备适配**：
  - 竖屏：0~90度（较小范围）
  - 桌面/横屏：0~180度（较大范围）
- **难度调整**：
  - 简单：0~45度
  - 中等：0~90度
  - 困难：0~180度
  - 极难：0~345度
- **默认值**：0~90（竖屏），0~180（桌面/横屏）
- **影响点**：拼图初始状态、游戏难度
- **配置/代码位置**：`utils/puzzle/ScatterPuzzle.ts`

### rotationRandomization
- **作用**：初始旋转随机化配置
- **随机策略**：
  - 完全随机：每个拼图块独立随机角度
  - 分组随机：相邻拼图块使用相似角度
  - 渐进随机：角度逐渐变化
  - 对称随机：保持某种对称性
- **默认值**：完全随机
- **影响点**：拼图块旋转的多样性和视觉效果
- **配置/代码位置**：`utils/puzzle/ScatterPuzzle.ts`（随机化逻辑）

### initialRotationSeed
- **作用**：初始旋转随机种子配置
- **种子类型**：
  - 时间戳种子：基于当前时间
  - 固定种子：可重现的随机序列
  - 用户种子：用户自定义种子
- **默认值**：时间戳种子
- **影响点**：旋转随机性的可重现性
- **配置/代码位置**：`utils/puzzle/ScatterPuzzle.ts`

---

## 3. 旋转交互配置

### rotationTrigger
- **作用**：旋转触发方式配置
- **触发方式**：
  - 'tap'：点击触发
  - 'longPress'：长按触发
  - 'doubleClick'：双击触发
  - 'gesture'：手势触发
- **默认值**：'tap'（桌面端），'gesture'（移动端）
- **影响点**：用户交互方式
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`（交互处理）

### rotationSensitivity
- **作用**：旋转灵敏度配置
- **灵敏度参数**：
  - 触摸灵敏度：触摸旋转的角度阈值
  - 鼠标灵敏度：鼠标旋转的移动阈值
  - 手势灵敏度：双指旋转的角度阈值
- **取值范围**：
  - 触摸：3~10度
  - 鼠标：5~20像素
  - 手势：5~15度
- **默认值**：触摸5度，鼠标10像素，手势5度
- **影响点**：旋转操作的响应性
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`

### rotationFeedback
- **作用**：旋转反馈配置
- **反馈类型**：
  - 视觉反馈：旋转动画、高亮效果
  - 听觉反馈：旋转音效
  - 触觉反馈：震动反馈（移动端）
- **默认值**：启用所有反馈类型
- **影响点**：用户操作的反馈体验
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`、`utils/rendering/soundEffects.ts`

---

## 4. 双指旋转配置

### rotationThreshold
- **作用**：双指旋转触发阈值
- **取值范围**：3~10（度）
- **默认值**：5度
- **影响点**：双指旋转的灵敏度
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`

### multiTouchRotation
- **作用**：多点触摸旋转配置
- **配置参数**：
  - 最小触摸点数：2
  - 最大触摸点数：2
  - 触摸点距离阈值：50px
  - 旋转中心计算：触摸点中心
- **默认值**：启用双指旋转
- **影响点**：移动端旋转操作的便利性
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`（多点触摸处理）

### gestureRotationSmoothing
- **作用**：手势旋转平滑化配置
- **平滑参数**：
  - 平滑系数：0.1~0.5
  - 最小角度变化：1度
  - 最大角度变化：30度/帧
- **默认值**：平滑系数0.3
- **影响点**：手势旋转的流畅性
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`（平滑处理）

---

## 5. 旋转音效配置

### rotateSound
- **作用**：拼图块旋转音效
- **音频参数**：
  - 频率：380Hz
  - 持续时间：0.12s
  - 波形：正弦波
  - 音量：0.25
- **默认值**：如上所示
- **影响点**：旋转操作的听觉反馈
- **配置/代码位置**：`utils/rendering/soundEffects.ts`（playRotateSound函数）

### soundVariation
- **作用**：旋转音效变化配置
- **变化策略**：
  - 频率变化：根据旋转角度调整
  - 音量变化：根据旋转速度调整
  - 音调变化：顺时针/逆时针不同音调
- **默认值**：启用音效变化
- **影响点**：音效的丰富性和方向感
- **配置/代码位置**：`utils/rendering/soundEffects.ts`

### soundThrottling
- **作用**：音效节流配置
- **节流参数**：
  - 最小间隔：100ms
  - 最大频率：10次/秒
  - 连续旋转合并：启用
- **默认值**：启用音效节流
- **影响点**：避免音效过于频繁
- **配置/代码位置**：`utils/rendering/soundEffects.ts`

---

## 6. 旋转动画配置

### rotationAnimation
- **作用**：旋转动画配置
- **动画参数**：
  - 动画时长：200ms
  - 缓动函数：ease-out
  - 插值方式：线性插值
- **默认值**：启用旋转动画
- **影响点**：旋转操作的视觉流畅性
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`（动画逻辑）

### animationOptimization
- **作用**：动画性能优化配置
- **优化策略**：
  - 使用CSS transform替代重绘
  - 启用硬件加速
  - 批量更新DOM
- **默认值**：启用所有优化
- **影响点**：旋转动画的性能表现
- **配置/代码位置**：动画实现逻辑

### animationInterruption
- **作用**：动画中断处理配置
- **中断策略**：
  - 允许中断：新旋转中断当前动画
  - 队列处理：旋转操作排队执行
  - 合并处理：连续旋转合并为一个动画
- **默认值**：允许中断
- **影响点**：连续旋转操作的响应性
- **配置/代码位置**：动画中断逻辑

---

## 7. 旋转约束配置

### rotationConstraints
- **作用**：旋转约束配置
- **约束类型**：
  - 角度约束：限制旋转角度范围
  - 速度约束：限制旋转速度
  - 频率约束：限制旋转频率
- **默认值**：无角度约束，有速度和频率约束
- **影响点**：旋转操作的合理性
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`

### rotationLimits
- **作用**：旋转限制配置
- **限制参数**：
  - 最大旋转速度：360度/秒
  - 最小旋转间隔：50ms
  - 连续旋转限制：10次/秒
- **默认值**：如上所示
- **影响点**：防止过度旋转操作
- **配置/代码位置**：旋转限制逻辑

### rotationValidation
- **作用**：旋转有效性验证配置
- **验证规则**：
  - 拼图块状态检查
  - 旋转角度有效性
  - 操作权限验证
- **默认值**：启用完整验证
- **影响点**：旋转操作的安全性
- **配置/代码位置**：旋转验证逻辑

---

## 8. 设备适配配置

### mobileRotationOptimization
- **作用**：移动端旋转优化配置
- **优化策略**：
  - 增大触摸目标区域
  - 优化手势识别精度
  - 减少动画复杂度
- **优化参数**：
  - 触摸区域：+20%
  - 手势阈值：降低20%
  - 动画时长：减少30%
- **默认值**：移动端自动启用
- **影响点**：移动端旋转体验
- **配置/代码位置**：`hooks/usePuzzleInteractions.ts`（移动端优化）

### touchRotationEnhancement
- **作用**：触摸旋转增强配置
- **增强功能**：
  - 触摸反馈增强
  - 手势识别优化
  - 误触防护
- **默认值**：移动端启用
- **影响点**：触摸旋转的准确性和便利性
- **配置/代码位置**：触摸处理逻辑

### devicePerformanceScaling
- **作用**：设备性能缩放配置
- **缩放策略**：
  - 低端设备：简化旋转动画
  - 高端设备：增强视觉效果
  - 自动性能检测
- **默认值**：启用性能缩放
- **影响点**：不同设备的旋转性能
- **配置/代码位置**：性能检测逻辑

---

## 9. 旋转状态管理配置

### rotationState
- **作用**：旋转状态管理配置
- **状态类型**：
  - 静止状态：拼图块未旋转
  - 旋转中：正在执行旋转
  - 旋转完成：旋转动画结束
- **默认值**：静止状态
- **影响点**：旋转操作的状态控制
- **配置/代码位置**：`contexts/GameContext.tsx`

### rotationHistory
- **作用**：旋转历史记录配置
- **记录内容**：
  - 旋转角度历史
  - 旋转时间戳
  - 旋转操作类型
- **记录长度**：最近10次操作
- **默认值**：启用历史记录
- **影响点**：撤销功能、调试分析
- **配置/代码位置**：旋转历史管理逻辑

### rotationSynchronization
- **作用**：旋转同步配置
- **同步策略**：
  - 状态同步：旋转状态实时同步
  - 动画同步：多个拼图块同步旋转
  - 音效同步：音效与动画同步
- **默认值**：启用状态同步
- **影响点**：旋转操作的一致性
- **配置/代码位置**：同步管理逻辑

---

## 10. 性能优化配置

### rotationPerformance
- **作用**：旋转性能优化配置
- **优化策略**：
  - 减少重绘次数
  - 使用硬件加速
  - 批量处理旋转
- **性能目标**：
  - 旋转响应时间：< 50ms
  - 动画帧率：> 30fps
  - CPU占用：< 15%
- **默认值**：启用所有优化
- **影响点**：旋转操作的性能表现
- **配置/代码位置**：性能优化逻辑

### memoryManagement
- **作用**：旋转内存管理配置
- **管理策略**：
  - 及时清理动画资源
  - 重用计算结果
  - 避免内存泄漏
- **默认值**：启用内存管理
- **影响点**：长期使用的内存稳定性
- **配置/代码位置**：内存管理逻辑

### rotationCaching
- **作用**：旋转计算缓存配置
- **缓存策略**：
  - 缓存旋转矩阵计算
  - 缓存角度转换结果
  - 智能缓存失效
- **默认值**：启用智能缓存
- **影响点**：重复旋转的性能
- **配置/代码位置**：缓存管理逻辑

---

## 11. 调试配置

### rotationDebugMode
- **作用**：旋转调试模式配置
- **调试功能**：
  - 显示旋转角度信息
  - 输出旋转计算详情
  - 验证旋转状态
- **默认值**：开发环境启用，生产环境禁用
- **影响点**：开发调试效率
- **配置/代码位置**：调试日志逻辑

### rotationVisualization
- **作用**：旋转可视化配置
- **可视化内容**：
  - 旋转中心点标记
  - 旋转角度指示器
  - 旋转轨迹显示
- **默认值**：调试模式下启用
- **影响点**：旋转分析和优化
- **配置/代码位置**：可视化逻辑

---

## 12. 配置示例

### 基础旋转配置示例
```typescript
// 旋转配置示例
const rotationConfig = {
  basic: {
    step: 15,
    direction: 'both',
    mode: 'discrete'
  },
  initial: {
    range: [0, 180],
    randomization: 'full',
    seed: 'timestamp'
  },
  interaction: {
    trigger: 'tap',
    sensitivity: 5,
    feedback: true
  }
};
```

### 设备适配配置示例
```typescript
// 设备特定旋转配置
const deviceRotationConfig = {
  mobile: {
    trigger: 'gesture',
    threshold: 5,
    optimization: true,
    touchEnhancement: true
  },
  desktop: {
    trigger: 'tap',
    threshold: 10,
    optimization: false,
    mouseSupport: true
  }
};
```

### 性能优化配置示例
```typescript
// 性能优化配置
const performanceConfig = {
  animation: {
    duration: 200,
    easing: 'ease-out',
    hardwareAcceleration: true
  },
  optimization: {
    caching: true,
    batching: true,
    memoryManagement: true
  },
  limits: {
    maxSpeed: 360,
    minInterval: 50,
    maxFrequency: 10
  }
};
```

---

## 13. 故障排除

### 常见问题
1. **旋转不响应**：检查旋转触发和灵敏度配置
2. **旋转卡顿**：调整动画优化和性能配置
3. **双指旋转失效**：验证多点触摸和手势配置
4. **旋转音效异常**：检查音效配置和触发条件

### 调试方法
- 启用旋转调试模式
- 检查旋转交互参数
- 验证设备适配配置
- 监控旋转性能指标

---

> 📖 **相关文档**
> - [碰撞与回弹配置](./09-collision-bounce.md)
> - [触摸事件与交互配置](./18-touch-interaction.md)
> - [媒体资源与音效配置](./13-media-sound.md)