<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·²å®Œæˆæ‹¼å›¾çª—å£è°ƒæ•´è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 1000px;
            margin: 0 auto;
        }
        .debug-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .debug-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status-good {
            color: #28a745;
            font-weight: bold;
        }
        .status-bad {
            color: #dc3545;
            font-weight: bold;
        }
        .status-warning {
            color: #ffc107;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>å·²å®Œæˆæ‹¼å›¾çª—å£è°ƒæ•´è°ƒè¯•å·¥å…·</h1>
        <p><strong>ç”¨é€”:</strong> è°ƒè¯•å’ŒéªŒè¯å·²å®Œæˆæ‹¼å›¾åœ¨çª—å£è°ƒæ•´æ—¶çš„é”å®šçŠ¶æ€</p>

        <div class="debug-section">
            <div class="debug-title">ğŸ® æµ‹è¯•æ“ä½œ</div>
            <button class="test-button" onclick="openGamePage()">æ‰“å¼€æ¸¸æˆé¡µé¢</button>
            <button class="test-button" onclick="resizeWindow(1200, 800)">è°ƒæ•´åˆ° 1200x800</button>
            <button class="test-button" onclick="resizeWindow(1000, 600)">è°ƒæ•´åˆ° 1000x600</button>
            <button class="test-button" onclick="resizeWindow(1400, 900)">è°ƒæ•´åˆ° 1400x900</button>
            <button class="test-button" onclick="clearDebugLog()">æ¸…ç©ºè°ƒè¯•æ—¥å¿—</button>
        </div>

        <div class="debug-section">
            <div class="debug-title">ğŸ” å…³é”®è°ƒè¯•ä¿¡æ¯ç›‘å¬</div>
            <div class="debug-info" id="debug-log">ç­‰å¾…è°ƒè¯•ä¿¡æ¯...</div>
        </div>

        <div class="debug-section">
            <div class="debug-title">ğŸ“Š ä¿®å¤çŠ¶æ€æ£€æŸ¥</div>
            <div id="fix-status">
                <p>è¯·å…ˆæ‰“å¼€æ¸¸æˆé¡µé¢ï¼Œå®Œæˆä¸€äº›æ‹¼å›¾å—ï¼Œç„¶åè°ƒæ•´çª—å£å¤§å°</p>
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">ğŸ“‹ é¢„æœŸçš„è°ƒè¯•ä¿¡æ¯</div>
            <div class="debug-info">
ä¿®å¤æ­£å¸¸å·¥ä½œæ—¶åº”è¯¥çœ‹åˆ°ï¼š

1. ç”»å¸ƒå°ºå¯¸å˜åŒ–æ£€æµ‹ï¼š
ğŸ”§ [ä¿®å¤æ£€æµ‹] ç”»å¸ƒå°ºå¯¸å˜åŒ–: 800x600 â†’ 1200x800
ğŸ”§ [ä¿®å¤æ£€æµ‹] å·²å®Œæˆæ‹¼å›¾: [0, 2]

2. originalPositionsæ›´æ–°ï¼š
âœ… [ä¿®å¤æˆåŠŸ] åŒæ­¥æ›´æ–°originalPositions: 6 ä¸ªç›®æ ‡ä½ç½®
ğŸ¯ [å·²å®Œæˆæ‹¼å›¾0] ç›®æ ‡ä½ç½®: (300.0, 250.0) â†’ (450.0, 375.0)

3. GameContextçŠ¶æ€æ›´æ–°ï¼š
ğŸ”§ [GameContext] æ›´æ–°originalPositions: 6 ä¸ªç›®æ ‡ä½ç½®

4. é¿å…é‡æ–°æ•£å¼€ï¼š
ğŸ”§ [GameContext] æ£€æµ‹åˆ°å·²å®Œæˆæ‹¼å›¾ï¼Œè·³è¿‡é‡æ–°æ•£å¼€ï¼Œäº¤ç”±é€‚é…ç³»ç»Ÿå¤„ç†
            </div>
        </div>
    </div>

    <script>
        let gameWindow = null;
        let debugLog = [];

        function openGamePage() {
            if (gameWindow && !gameWindow.closed) {
                gameWindow.focus();
                return;
            }
            
            gameWindow = window.open('/', 'game', 'width=1200,height=800');
            
            // ç›‘å¬æ¸¸æˆçª—å£çš„æ§åˆ¶å°æ¶ˆæ¯
            if (gameWindow) {
                // æ³¨å…¥è°ƒè¯•ç›‘å¬å™¨
                gameWindow.addEventListener('load', () => {
                    // é‡å†™console.logæ¥æ•è·è°ƒè¯•ä¿¡æ¯
                    const originalLog = gameWindow.console.log;
                    gameWindow.console.log = function(...args) {
                        originalLog.apply(gameWindow.console, args);
                        
                        const message = args.join(' ');
                        if (message.includes('[ä¿®å¤') || 
                            message.includes('originalPositions') || 
                            message.includes('[GameContext]') ||
                            message.includes('ç”»å¸ƒå°ºå¯¸å˜åŒ–') ||
                            message.includes('å·²å®Œæˆæ‹¼å›¾') ||
                            message.includes('è·³è¿‡é‡æ–°æ•£å¼€')) {
                            
                            addDebugLog(message);
                        }
                    };
                    
                    updateFixStatus();
                });
            }
        }

        function resizeWindow(width, height) {
            if (!gameWindow || gameWindow.closed) {
                alert('è¯·å…ˆæ‰“å¼€æ¸¸æˆé¡µé¢');
                return;
            }
            
            gameWindow.resizeTo(width, height);
            addDebugLog(`ğŸ”§ [è°ƒè¯•å·¥å…·] çª—å£è°ƒæ•´åˆ°: ${width}x${height}`);
            
            // å»¶è¿Ÿæ£€æŸ¥çŠ¶æ€
            setTimeout(updateFixStatus, 1000);
        }

        function addDebugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            
            // ä¿æŒæœ€æ–°çš„50æ¡è®°å½•
            if (debugLog.length > 50) {
                debugLog = debugLog.slice(-50);
            }
            
            updateDebugDisplay();
        }

        function updateDebugDisplay() {
            const logElement = document.getElementById('debug-log');
            logElement.textContent = debugLog.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearDebugLog() {
            debugLog = [];
            updateDebugDisplay();
        }

        function updateFixStatus() {
            if (!gameWindow || gameWindow.closed) {
                return;
            }
            
            try {
                const gameState = gameWindow.__gameStateForTests__;
                if (!gameState) {
                    document.getElementById('fix-status').innerHTML = 
                        '<p class="status-warning">æ¸¸æˆçŠ¶æ€æœªå°±ç»ª</p>';
                    return;
                }
                
                const hasCompletedPieces = gameState.completedPieces && gameState.completedPieces.length > 0;
                const hasOriginalPositions = gameState.originalPositions && gameState.originalPositions.length > 0;
                
                let statusHtml = '<div>';
                statusHtml += `<p>æ‹¼å›¾æ€»æ•°: ${gameState.puzzle ? gameState.puzzle.length : 0}</p>`;
                statusHtml += `<p>å·²å®Œæˆæ‹¼å›¾: ${gameState.completedPieces ? gameState.completedPieces.length : 0} [${gameState.completedPieces ? gameState.completedPieces.join(', ') : ''}]</p>`;
                statusHtml += `<p>ç›®æ ‡ä½ç½®æ•°æ®: ${hasOriginalPositions ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}</p>`;
                statusHtml += `<p>ç”»å¸ƒå°ºå¯¸: ${gameState.canvasWidth}x${gameState.canvasHeight}</p>`;
                
                if (hasCompletedPieces) {
                    statusHtml += '<p class="status-good">âœ… æœ‰å·²å®Œæˆæ‹¼å›¾ï¼Œå¯ä»¥æµ‹è¯•ä¿®å¤æ•ˆæœ</p>';
                    statusHtml += '<p>è¯·è°ƒæ•´çª—å£å¤§å°ï¼Œè§‚å¯Ÿè°ƒè¯•ä¿¡æ¯å’Œæ‹¼å›¾ä½ç½®</p>';
                } else {
                    statusHtml += '<p class="status-warning">âš ï¸ è¯·å…ˆå®Œæˆä¸€äº›æ‹¼å›¾å—</p>';
                }
                
                statusHtml += '</div>';
                document.getElementById('fix-status').innerHTML = statusHtml;
                
            } catch (error) {
                document.getElementById('fix-status').innerHTML = 
                    `<p class="status-bad">âŒ æ— æ³•è·å–æ¸¸æˆçŠ¶æ€: ${error.message}</p>`;
            }
        }

        // å®šæœŸæ›´æ–°çŠ¶æ€
        setInterval(updateFixStatus, 2000);
        
        console.log('ğŸ”§ å·²å®Œæˆæ‹¼å›¾çª—å£è°ƒæ•´è°ƒè¯•å·¥å…·å·²åŠ è½½');
        console.log('ğŸ“‹ ä½¿ç”¨æ­¥éª¤:');
        console.log('1. ç‚¹å‡»"æ‰“å¼€æ¸¸æˆé¡µé¢"');
        console.log('2. åœ¨æ¸¸æˆä¸­ç”Ÿæˆæ‹¼å›¾å¹¶å®Œæˆä¸€äº›æ‹¼å›¾å—');
        console.log('3. ä½¿ç”¨è°ƒæ•´çª—å£æŒ‰é’®æµ‹è¯•ä¿®å¤æ•ˆæœ');
        console.log('4. è§‚å¯Ÿè°ƒè¯•ä¿¡æ¯å’Œæ‹¼å›¾ä½ç½®å˜åŒ–');
    </script>
</body>
</html>